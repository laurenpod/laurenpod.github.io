"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3052,726],{81785:function(e,t,n){n.d(t,{HN:function(){return l},SE:function(){return c},Tx:function(){return d}});var r=n(83041),a=n(16096),o=n(35146),i=n(84983),s=n(79090),u=n(80726);let l=(e,t)=>{let{account:n,activeOrganization:s}=(0,a.useCurrentAccount)(),l=t===(null==n?void 0:n.uuid),c=null==s?void 0:s.uuid,d=(0,i.useQueryClient)(),p=(0,u.Gm)();return(0,r.uC)(()=>"/api/organizations/".concat(c,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries([o.l3,{projectUuid:e}]),l&&(p(e),d.invalidateQueries([o.VH,{orgUUID:c}]),d.invalidateQueries([o.tv,{orgUUID:c}]))}})},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,a.useCurrentAccount)(),i=null==n?void 0:n.uuid,u=(0,s.rb)(e);return(0,r.WE)("/api/organizations/".concat(i,"/projects/").concat(e,"/accounts"),{queryKey:[o.l3,{projectUuid:e}],enabled:!!(t&&u&&n&&e),staleTime:0})},d=e=>{let{activeOrganization:t}=(0,a.useCurrentAccount)(),n=null==t?void 0:t.uuid,s=(0,i.useQueryClient)();return(0,r.uC)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{s.invalidateQueries([o.l3,{projectUuid:e}])},transformVariables:e=>({role:e.role})})}},37076:function(e,t,n){n.d(t,{ER:function(){return l},Kf:function(){return s},u3:function(){return u}});var r=n(83041),a=n(16096),o=n(35146),i=n(84983);let s=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.useCurrentAccount)(),i=null==n?void 0:n.uuid,{data:s,...u}=(0,r.WE)("/api/organizations/".concat(i,"/projects/").concat(t,"/docs"),{queryKey:[o.zy,{orgUuid:i,projectUuid:t}],enabled:!!n&&!!t,staleTime:0}),l=s;return s&&(l=s.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0})),l&&(l=l.filter(e=>{let{file_name:t}=e;return"[ANT ONLY] synced_resources.txt"!==t})),{data:l,unfilteredData:s,...u}},u=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.useCurrentAccount)(),s=null==n?void 0:n.uuid,u=(0,i.useQueryClient)();return(0,r.uC)(()=>"/api/organizations/".concat(s,"/projects/").concat(t,"/docs"),"POST",{enabled:!!t,onSuccess:()=>{u.invalidateQueries([o.zy,{orgUuid:s,projectUuid:t}]),u.invalidateQueries([o.n$,{orgUuid:s}]),u.invalidateQueries([o.VH,{orgUUID:s}])}})},l=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.useCurrentAccount)(),s=null==n?void 0:n.uuid,u=(0,i.useQueryClient)();return(0,r.uC)(e=>"/api/organizations/".concat(s,"/projects/").concat(t,"/docs/").concat(e.docUuid),"DELETE",{enabled:!!t,onSuccess:(e,n)=>{u.invalidateQueries([o.tt,{orgUuid:s,projectUuid:t,docUuid:n.docUuid}]),u.invalidateQueries([o.zy,{orgUuid:s,projectUuid:t}]),u.invalidateQueries([o.n$,{orgUuid:s}]),u.invalidateQueries([o.VH,{orgUUID:s}])}})}},79090:function(e,t,n){n.d(t,{AQ:function(){return f},AT:function(){return y},Hq:function(){return l},LN:function(){return v},gr:function(){return d},l2:function(){return p},rb:function(){return c},yg:function(){return h},zB:function(){return m}});var r=n(83041),a=n(16096),o=n(87050),i=n(35146),s=n(84983),u=n(72034);let l=e=>{let{activeOrganization:t}=(0,a.useCurrentAccount)(),n=null==t?void 0:t.uuid;return(0,r.WE)("/api/organizations/".concat(n,"/projects/").concat(e,"/sync/auth"),{queryKey:[i.Xg,{orgUuid:n,projectUuid:e}],enabled:!!(e&&t)})},c=e=>{let{data:t,isLoading:n}=l(e);return!!(!n&&!(null==t?void 0:t.find(e=>e.access!==u.mK.CAN_ACCESS)))},d=function(e){let{projectUuid:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:i}=(0,a.useCurrentAccount)(),s=null==i?void 0:i.uuid,{value:u}=(0,o.F)("nighthawk_enabled"),l=g();return(0,r.uC)(()=>"/api/organizations/".concat(s,"/projects/").concat(t,"/syncs"),"POST",{enabled:!!(u&&i&&t),...n,onSuccess:function(){for(var e,r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];l(t),null===(e=n.onSuccess)||void 0===e||e.call(n,...a)}})},p=function(e){let{projectUuid:t}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:i}=(0,a.useCurrentAccount)(),s=null==i?void 0:i.uuid,{value:u}=(0,o.F)("nighthawk_enabled"),l=g();return(0,r.uC)(()=>"/api/organizations/".concat(s,"/projects/").concat(t,"/syncs"),"PUT",{enabled:!!(u&&i&&t),...n,onSuccess:function(){for(var e,r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];l(t),null===(e=n.onSuccess)||void 0===e||e.call(n,...a)}})},m=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,a.useCurrentAccount)(),{value:i}=(0,o.F)("nighthawk_enabled"),s=null==n?void 0:n.uuid,u=g();return(0,r.uC)(e=>"/api/organizations/".concat(s,"/projects/").concat(t,"/syncs/").concat(e),"DELETE",{enabled:i&&!n,onSuccess:()=>{u(t)}})},h=e=>{let{activeOrganization:t}=(0,a.useCurrentAccount)(),{value:n}=(0,o.F)("nighthawk_enabled"),{data:s}=(0,u.bj)(),{value:l}=(0,o.F)("kingfisher_enabled"),{data:c}=(0,u.oE)(),d=null==t?void 0:t.uuid,p=n&&!!(null==s?void 0:s.is_authenticated),m=l&&!!(null==c?void 0:c.is_authenticated),h=(p||m)&&!!t&&!!e;return(0,r.WE)("/api/organizations/".concat(d,"/projects/").concat(e,"/syncs"),{queryKey:[i.AI,{orgUuid:d,projectUuid:e}],enabled:h,refetchInterval:e=>(null==e?void 0:e.some(v))?5e3:3e5})},g=()=>{let{activeOrganization:e}=(0,a.useCurrentAccount)(),t=null==e?void 0:e.uuid,n=(0,s.useQueryClient)();return e=>{n.invalidateQueries([i.AI,{orgUuid:t,projectUuid:e}]),n.invalidateQueries([i.Xg,{orgUuid:t,projectUuid:e}])}},f=e=>{let{data:t}=h(e);return!!(null==t?void 0:t.some(v))},v=e=>[u.co.CREATED,u.co.PENDING,u.co.UPDATING].includes(e.status.state),y=e=>[u.co.FAILED,u.co.UPDATE_FAILED].includes(e.status.state)},80726:function(e,t,n){n.d(t,{Gm:function(){return x},Kn:function(){return C},O3:function(){return h},Qs:function(){return y},Yc:function(){return v},bQ:function(){return g},dY:function(){return _},iR:function(){return b},u0:function(){return f}});var r=n(94354),a=n(83041),o=n(16096),i=n(28648),s=n(35146),u=n(84983),l=n(99733),c=n.n(l),d=n(7653),p=n(20705),m=n(79090);let h=()=>{let{activeOrganization:e}=(0,o.useCurrentAccount)(),t=(0,p.U)(),n=null==e?void 0:e.uuid;return(0,a.WE)("/api/organizations/".concat(n,"/projects"),{queryKey:[s.gi,{orgUuid:n}],enabled:!!(e&&t),staleTime:0,select:e=>e.filter(e=>!e.archived_at)})},g=()=>{let{data:e,isLoading:t}=h();return{data:null==e?void 0:e.filter(e=>e.is_starred),isLoading:t}},f=()=>{let{data:e,isLoading:t}=(0,r.QR)(),{data:n,isLoading:a}=h();return(0,d.useMemo)(()=>{if(t||a)return{data:n,isLoading:!0};if(!n||!e)return{data:n,isLoading:!1};let r=n.map(t=>({...t,lastConversation:null==e?void 0:e.find(e=>e.project_uuid===t.uuid)})).filter(e=>e.lastConversation).sort((e,t)=>new Date(t.lastConversation.created_at).getTime()-new Date(e.lastConversation.created_at).getTime()),o=null==n?void 0:n.filter(e=>!r.find(t=>t.uuid===e.uuid));return{data:[...r,...o],isLoading:!1}},[n,e,t,a])},v=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,o.useCurrentAccount)(),r=null==n?void 0:n.uuid,u=(0,m.rb)(t);return(0,a.WE)("/api/organizations/".concat(r,"/projects/").concat(t),{queryKey:[s.$T,{orgUuid:r,projectUuid:t}],enabled:!!(u&&n&&t),staleTime:0,meta:{noToast:e=>e instanceof i.Hx&&404===e.statusCode}})},y=()=>{let{activeOrganization:e}=(0,o.useCurrentAccount)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return(0,a.uC)(()=>"/api/organizations/".concat(t,"/projects"),"POST",{onSuccess:()=>{n.invalidateQueries([s.gi,{orgUuid:t}]),n.invalidateQueries([s.n$,{orgUuid:t}])}})},_=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,o.useCurrentAccount)(),r=null==n?void 0:n.uuid,i=x();return(0,a.Ne)(()=>"/api/organizations/".concat(r,"/projects/").concat(t),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{i(t)},queryKey:[s.$T,{orgUuid:r,projectUuid:t}]})},b=e=>{let{projectUuid:t}=e,{activeOrganization:n}=(0,o.useCurrentAccount)(),r=null==n?void 0:n.uuid,i=(0,m.rb)(t);return(0,a.WE)("/api/organizations/".concat(r,"/projects/").concat(t,"/conversations"),{queryKey:[s.lx,{orgUuid:r,projectUuid:t}],enabled:!!(i&&n),staleTime:0,select:e=>c()(e,e=>new Date(e.updated_at)).reverse()})},C=()=>{var e,t;let n=h(),r=null===(t=n.data)||void 0===t?void 0:null===(e=t.find(e=>e.is_starter_project))||void 0===e?void 0:e.uuid;return{...n,data:r}},x=()=>{let{activeOrganization:e}=(0,o.useCurrentAccount)(),t=null==e?void 0:e.uuid,n=(0,u.useQueryClient)();return e=>{n.invalidateQueries([s.$T,{orgUuid:t,projectUuid:e}]),n.invalidateQueries([s.gi,{orgUuid:t}]),n.invalidateQueries([s.n$,{orgUuid:t}]),n.invalidateQueries([s.lx,{orgUuid:t,projectUuid:e}])}}},72034:function(e,t,n){n.d(t,{E4:function(){return S},Fg:function(){return c},Hs:function(){return x},M1:function(){return b},Mr:function(){return A},N:function(){return P},P8:function(){return T},Y$:function(){return O},bj:function(){return C},cQ:function(){return z},co:function(){return p},g0:function(){return w},lP:function(){return k},mK:function(){return d},oE:function(){return E},tc:function(){return _}});var r,a,o,i,s,u,l,c,d,p,m=n(83041),h=n(16096),g=n(87050),f=n(35146),v=n(84983),y=n(54603);(r=u||(u={})).PENDING="pending",r.STARTED="started",r.COMPLETED="completed",r.FAILED="failed",(a=l||(l={})).PATH_NOT_FOUND="path_not_found",a.INVALID_SHA="invalid_sha",a.SIZE_LIMIT_EXCEEDED="size_limit_exceeded",a.SOURCE_MISSING_OR_CHANGED="source_missing_or_changed",(o=c||(c={})).GITHUB="github",o.GDRIVE="gdrive",(i=d||(d={})).NOT_AUTHENTICATED="not_authenticated",i.NOT_AUTHORIZED="not_authorized",i.CAN_ACCESS="can_access",(s=p||(p={})).CREATED="created",s.PENDING="pending",s.FAILED="failed",s.UPDATING="updating",s.UPDATE_FAILED="update_failed",s.READY="ready";let _=()=>{let{activeOrganization:e}=(0,h.useCurrentAccount)(),t=null==e?void 0:e.uuid,{value:n}=(0,g.F)("nighthawk_enabled"),{value:r}=(0,g.F)("kingfisher_enabled");return(0,m.WE)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[f.FU,{orgUUID:t}],enabled:!!(e&&(n||r))})},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,h.useCurrentAccount)(),n=null==t?void 0:t.uuid,{value:r}=(0,g.F)("nighthawk_enabled"),{value:a}=(0,g.F)("kingfisher_enabled"),o=(0,v.useQueryClient)();return(0,m.Ne)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:r}=e;t||(t=[]);let a=t.map(e=>e.type===n?{...e,enabled:r}:e);return a.some(e=>e.type===n)?a:[...t,{type:n,enabled:r}]},{queryKey:[f.FU,{orgUUID:n}],enabled:!!(t&&(r||a)),onSuccess:async function(){for(var t,r=arguments.length,a=Array(r),i=0;i<r;i++)a[i]=arguments[i];await o.invalidateQueries([f.FU,{orgUUID:n}]),await (null===(t=e.onSuccess)||void 0===t?void 0:t.call(e,...a))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},C=()=>{let{activeOrganization:e}=(0,h.useCurrentAccount)(),t=null==e?void 0:e.uuid,n=T();return(0,m.WE)("/api/organizations/".concat(t,"/sync/github/auth"),{queryKey:[f.Os,{orgUUID:t}],enabled:!!(e&&n)})},x=()=>{let{activeOrganization:e}=(0,h.useCurrentAccount)(),t=null==e?void 0:e.uuid,{value:n}=(0,g.F)("nighthawk_enabled"),r=(0,y.useRouter)();return(0,m.uC)("/api/organizations/".concat(t,"/sync/github/auth/start"),"POST",{enabled:!!(e&&n),onSuccess:e=>{r.push(e.redirect_url)}})},S=()=>{let{data:e}=_();return!!(null==e?void 0:e.find(e=>"gdrive"===e.type&&e.enabled))},E=()=>{let{account:e,activeOrganization:t}=(0,h.useCurrentAccount)(),n=null==e?void 0:e.uuid,r=null==t?void 0:t.uuid,a=S();return(0,m.WE)("/api/organizations/".concat(r,"/sync/mcp/drive/auth"),{queryKey:[f.Yw,{accountUUID:n,orgUUID:r}],enabled:a,staleTime:5e3})},w=()=>{let{activeOrganization:e}=(0,h.useCurrentAccount)(),t=null==e?void 0:e.uuid,n=S(),r=(0,y.useRouter)();return(0,m.uC)("/api/organizations/".concat(t,"/sync/mcp/drive/auth/start"),"POST",{enabled:n,onSuccess:e=>{r.push(e.redirect_url)}})},z=e=>{let{documentId:t}=e,{account:n,activeOrganization:r}=(0,h.useCurrentAccount)(),a=null==n?void 0:n.uuid,o=null==r?void 0:r.uuid,i=S();return(0,m.WE)("/api/organizations/".concat(o,"/sync/mcp/drive/document/").concat(t),{queryKey:[f.Yp,{accountUUID:a,orgUUID:o,documentId:t}],enabled:i})},k=()=>{let{mutate:e}=x(),{mutate:t}=w();return(n,r)=>{"github"===n?e({pre_auth_state:r}):"gdrive"===n&&t({pre_auth_state:r,redirect_uri:new URL("/connect/mcp/drive/callback",window.location.origin).toString()})}},T=()=>{let{data:e}=_();return!!(null==e?void 0:e.find(e=>"github"===e.type&&e.enabled))},A=()=>{let{activeOrganization:e}=(0,h.useCurrentAccount)(),t=null==e?void 0:e.uuid,n=T();return(0,m.WE)("/api/organizations/".concat(t,"/sync/github/repos"),{queryKey:[f.wD,{orgUUID:t}],enabled:!!(e&&n),meta:{noToast:!0}})},j=e=>{let{owner:t,repo:n,branch:r}=e,{activeOrganization:a}=(0,h.useCurrentAccount)(),o=null==a?void 0:a.uuid,i=T(),s=new URLSearchParams({owner:null!=t?t:"",repo:null!=n?n:""}).toString();return(0,m.WE)("/api/organizations/".concat(o,"/sync/github/repo?").concat(s),{queryKey:[f.Rz,{orgUUID:o,owner:t,repo:n}],enabled:!!(t&&n&&!r&&a&&i),meta:{noToast:!0}})},N=e=>{let{owner:t,repo:n,branch:r}=e,{activeOrganization:a}=(0,h.useCurrentAccount)(),o=null==a?void 0:a.uuid,i=T();return(0,m.WE)("/api/organizations/".concat(o,"/sync/github/repo/").concat(t,"/").concat(n,"/tree/").concat(r),{queryKey:[f.E0,{orgUUID:o,owner:t,repo:n,branch:r}],enabled:!!(t&&n&&r&&a&&i),meta:{noToast:!0}})},O=e=>{var t;let{owner:n,repo:r,branch:a}=e,o=j({owner:n,repo:r,branch:a}),i=N({owner:n,repo:r,branch:a||(null===(t=o.data)||void 0===t?void 0:t.default_branch)});return{data:{repo:o.data,tree:i.data},isFetching:o.isFetching||i.isFetching,error:o.error||i.error}},P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,h.useCurrentAccount)(),n=null==t?void 0:t.uuid,r=(0,v.useQueryClient)();return(0,m.uC)("/api/organizations/".concat(n,"/sync/github/auth"),"DELETE",{enabled:!!t,...e,onSuccess:function(){for(var t,a=arguments.length,o=Array(a),i=0;i<a;i++)o[i]=arguments[i];r.invalidateQueries([f.Os,{orgUUID:n}]),null===(t=e.onSuccess)||void 0===t||t.call(e,...o)}})}},20705:function(e,t,n){n.d(t,{U:function(){return a}});var r=n(16096);let a=()=>{let e=(0,r.useHasProSubscription)();return(0,r.useHasRaven)()||e}},39258:function(e,t,n){n.d(t,{x:function(){return m},r:function(){return p}});var r=n(27573),a=n(10075),o=n(7653),i=n(79090);n(745);var s=n(27909),u=n(92627);let l=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),c=e=>{let t=(0,o.useCallback)(t=>{if(!(!e||l(document.activeElement))&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;t.preventDefault(),null===(n=e.getEditor())||void 0===n||n.chain().insertContent(t.key).focus().run()}},[e]);(0,o.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},d=o.createContext({attachments:[],files:[],model:"",prompt:"",project:void 0,isProjectSyncing:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setModel:()=>Promise.resolve(),setProject:()=>void 0,sendMessage:()=>void 0,stopSampling:()=>void 0,conversation:void 0,focusInput:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0}),p=()=>o.useContext(d),m=e=>{var t,n;let l=(0,o.useRef)(null),p="conversation"in e,{children:m,projectId:h,namespace:g}=e,f=p?e.conversation:void 0;c(l.current);let{input:v,setInput:y,attachments:_,setAttachments:b,files:C,setFiles:x,clear:S}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=n?"".concat(n,":"):"",[a,i,s]=(0,u.Rr)("".concat(r).concat(e,":attachment"),[]),[l,c,d]=(0,u.Rr)("".concat(r).concat(e,":files"),[]),[p,m,h]=(0,u.Rr)("".concat(r).concat(e,":textInput"),t);return{attachments:a,setAttachments:i,files:l,setFiles:c,input:p,setInput:m,clear:(0,o.useCallback)(()=>{h(),s(),d()},[s,h,d])}}(null!==(t=null==f?void 0:f.id)&&void 0!==t?t:void 0===h?"new-conversation":"".concat(h,":conversation"),"",g),[E,w]=o.useState(null==f?void 0:f.model),{stickyModelPreference:z}=(0,a.M)();(0,o.useEffect)(()=>{!E&&z&&w(z)},[z,E,w]);let[k,T]=o.useState(h),A=(0,i.AQ)(k),[j,N]=o.useState(!1),{isEnabled:O}=(0,s.Y)(k||h||""),{unsavedChangesState:[P],updateProjectFiles:I}={unsavedChangesState:[void 0],updateProjectFiles:void 0},R=async()=>{if(l.current&&(""!==v.trim()||0!==_.length||0!==C.length)){O&&P&&Object.values(P).some(e=>e.length>0)&&await (null==I?void 0:I()),S(),e.willRedirectOnSubmit?l.current.setEditable(!1):l.current.setContent(""),N(!0);try{p?await e.onSend({prompt:v,attachments:_,files:C}):await e.onCreate({prompt:v,attachments:_,files:C,model:E,project:k})}catch(e){var t;y(v),null===(t=l.current)||void 0===t||t.setContent(v),b(_),x(C),l.current.setEditable(!0)}finally{N(!1)}}},D=async t=>{if(w(t),p){N(!0);try{await e.onCreate({prompt:v,attachments:_,files:C,model:t,project:k})}finally{N(!1)}}},[F,M]=o.useState(!1);return(0,r.jsx)(d.Provider,{value:{prompt:v,attachments:_,files:C,model:E,project:k,isProjectSyncing:A,isProjectLocked:void 0!==h||void 0!==f,isSending:j,setPrompt:function(e){let{forceUpdateTiptap:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(y(e),!0===t){var n;null===(n=l.current)||void 0===n||n.setContent(e)}},setAttachments:e=>b(e),setFiles:e=>x(e),setModel:D,setProject:T,sendMessage:R,stopSampling:()=>{p&&e.onStopSampling()},conversation:f,focusInput:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.focus()},promptInputRef:l,willRedirectOnSubmit:null!==(n=e.willRedirectOnSubmit)&&void 0!==n&&n,hasBlockingWarning:F,setHasBlockingWarning:M},children:m})}},745:function(e,t,n){n.d(t,{X:function(){return i}}),n(27573),n(59374);var r=n(7653);n(37076),n(83186),n(61837);let a=e=>async()=>(await Promise.resolve(),e),o=(0,r.createContext)({resources:[],syncedDirectoryUris:[],addSyncedDirectory:a(),removeSyncedDirectory:a(),resync:a(),searchFiles:a([]),getFileContent:a(null),writeFileContent:a(!1),unsavedChangesState:[{},()=>{}],updateProjectFiles:a(),setUpdateProjectFiles:()=>{}}),i=()=>{let e=(0,r.useContext)(o);return e||console.warn("useLocalFileSync being used outside of LocalFileSyncProvider, this is probably a bug"),e}},27909:function(e,t,n){n.d(t,{Y:function(){return s}});var r=n(16096),a=n(80248),o=n(81785),i=n(80726);let s=e=>{let{account:t}=(0,r.useCurrentAccount)(),{data:n}=(0,i.Yc)({projectUuid:e}),{data:s}=(0,o.SE)(e||"");return null==s||s.some(e=>e.account.uuid===(null==t?void 0:t.uuid)&&"user"===e.role),"showDirectoryPicker"in window&&window,{isEnabled:!1,config:(0,a.useConfig)("harmony").config}}},83186:function(e,t,n){n(22982),n(7653)},34077:function(e,t,n){n.d(t,{KX:function(){return m},O3:function(){return y},P2:function(){return f},TD:function(){return _},q2:function(){return v},to:function(){return a},vr:function(){return h}});var r,a,o=n(64507),i=n(68444),s=n(40350);(r=a||(a={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",r.SetContent="anthropic.claude.usercontent.sandbox.SetContent",r.GetFile="anthropic.claude.usercontent.sandbox.GetFile",r.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",r.RunCode="anthropic.claude.usercontent.sandbox.RunCode",r.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",r.ReportError="anthropic.claude.usercontent.sandbox.ReportError";let u=i.z.object({type:i.z.literal("UnsupportedImports"),unsupportedModules:i.z.array(i.z.string()),nonExistentIcons:i.z.array(i.z.string())}),l=i.z.object({type:i.z.literal("RuntimeError"),message:i.z.string()}),c=i.z.object({type:i.z.literal("FileNotFound"),fileName:i.z.string()}),d=i.z.object({type:i.z.literal("ClaudeCompletionError"),message:i.z.string()}),p=i.z.discriminatedUnion("type",[u,l,c,d]),m=i.z.object({code:i.z.string()}),h=i.z.object({status:i.z.enum(["success","error"]),result:i.z.string().optional(),logs:i.z.array(i.z.string()),error:i.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:i.z.strictObject({"@type":i.z.literal("anthropic.claude.usercontent.sandbox.SandboxContent"),content:i.z.string(),type:i.z.nativeEnum(o.JP)})}),responseSchema:s.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:i.z.strictObject({"@type":i.z.literal("google.protobuf.Empty")})}),responseSchema:s.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:i.z.strictObject({key:i.z.string(),"@type":i.z.literal("anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:s.Tk.extend({payload:i.z.strictObject({value:i.z.instanceof(Uint8Array).nullable(),"@type":i.z.literal("anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:i.z.strictObject({message:i.z.string(),messageType:i.z.enum(["text","error"]),"@type":i.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:s.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:i.z.strictObject({code:i.z.string(),"@type":i.z.literal("anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:s.Tk.extend({payload:i.z.strictObject({"@type":i.z.literal("anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(h)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:i.z.strictObject({prompt:i.z.string(),"@type":i.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:s.Tk.extend({payload:i.z.strictObject({completion:i.z.string().nullable(),"@type":i.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:s.Zq.extend({method:i.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:i.z.strictObject({"@type":i.z.literal("anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:p})}),responseSchema:s.AY,alwaysPermitted:!0}},f=i.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError"]),v=i.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema]);i.z.union([s.AY,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),i.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode"]),i.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema]);let y=i.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema]),_=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},40350:function(e,t,n){n.d(t,{AY:function(){return u},D7:function(){return l},Kj:function(){return s},Tk:function(){return i},Zq:function(){return o},qV:function(){return a},v8:function(){return c}});var r=n(68444);let a=r.z.object({channel:r.z.enum(["request","response"]),requestId:r.z.string()}).passthrough(),o=a.strict().extend({channel:r.z.literal("request"),method:r.z.string(),payload:r.z.strictObject({"@type":r.z.string()})}),i=a.extend({channel:r.z.literal("response"),status:r.z.number().int().min(100).max(599),payload:r.z.strictObject({"@type":r.z.string()}).passthrough()}).passthrough(),s=i.extend({status:r.z.number().int().min(400).max(599),payload:r.z.strictObject({"@type":r.z.literal("anthropic.claude.usercontent.ErrorResponse"),error:r.z.string()})}),u=i.extend({payload:r.z.strictObject({"@type":r.z.literal("google.protobuf.Empty")})}),l={"@type":"google.protobuf.Empty"},c=e=>({"@type":"anthropic.claude.usercontent.ErrorResponse",error:e})},47587:function(e,t,n){n.d(t,{M:function(){return o},T:function(){return a}});var r=n(7653);let a=(0,r.createContext)(null),o=()=>{let e=(0,r.useContext)(a);if(!e)throw Error("usePersistentSandbox must be used within a PersistentSandboxProvider");return e}},79755:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(27573),a=n(11492),o=n(16096),i=n(77997);let s=()=>{let e=(0,a.useIsClaudeDot)(),{websiteBaseUrl:t}=(0,a.useConfiguration)();return e?(0,r.jsxs)(r.Fragment,{children:[" ","Or consider"," ",(0,r.jsx)("a",{href:"/settings/billing?action=subscribe",className:"font-bold underline",rel:"noreferrer",children:"upgrading to Claude Pro"}),"."]}):(0,r.jsxs)(r.Fragment,{children:[" ","Or"," ",(0,r.jsx)(i.default,{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:"contact sales"})," ","if you would be interested in upgrading to a paid version of Claude."]})};function u(){let e=(0,o.useCanUpgradeToPro)(),t=(0,o.useIsReadOnlyMode)();return e&&!t?(0,r.jsx)(s,{}):null}},11925:function(e,t,n){n.d(t,{hH:function(){return D},wN:function(){return Q},Qk:function(){return H},pV:function(){return F},lE:function(){return M}});var r,a,o,i,s=n(27573),u=n(79755),l=n(11492),c=n(16096),d=n(59374),p=n(89937),m=n(28648),h=n(14983),g=n(35146),f=n(28505),v=n(43316),y=n(84983),_=n(2645),b=n(71875),C=n(54603),x=n(7653),S=n(80248),E=n(94354),w=n(47587);class z{_getBlockCharCount(e){if("text"===e.type)return e.text.length;if("tool_use"===e.type){var t;return(null===(t=e.partial_json)||void 0===t?void 0:t.length)||0}return e.type,0}_maybeConvertMessageEventToContentBlock(e){switch(e.type){case"content_block_delta":if("text_delta"===e.delta.type)return{type:"text",text:e.delta.text};if("input_json_delta"===e.delta.type){let t=this.completionsToSmooth[this.completionsToSmooth.length-1];if(t&&"tool_use"===t.type)return{type:"tool_use",id:"",name:"",partial_json:e.delta.partial_json};if(t&&"tool_result"===t.type)return{type:"tool_result",tool_use_id:"",content:[{type:"text",text:e.delta.partial_json}]}}break;case"content_block_start":return e.content_block}}_set_raw_completion(e){0===this.start&&(this.start=Date.now());let t=this._maybeConvertMessageEventToContentBlock(e);t&&(e=>{if(0===this.completionsToSmooth.length){this.completionsToSmooth.push(e);return}let t=this.completionsToSmooth[this.completionsToSmooth.length-1];if(t.type!==e.type){this.completionsToSmooth.push(e);return}switch(e.type){case"text":"text"===t.type&&(t.text+=e.text);break;case"tool_use":if("tool_use"===t.type){var n,r;t.partial_json=(null!==(n=t.partial_json)&&void 0!==n?n:"")+(null!==(r=e.partial_json)&&void 0!==r?r:"")}break;case"tool_result":"tool_result"===t.type&&(t.content=e.content)}})(t),this.model_done="message_stop"===e.type;let n=this.completionsToSmooth.reduce((e,t)=>e+this._getBlockCharCount(t),0);this.totalCompletionLength=n,this.arrivals.push([(Date.now()-this.start)/1e3,n])}_get_smoothed_completion(){if(0===this.start)return[];let e=(Date.now()-this.start)/1e3,t=this.arrivals[this.arrivals.length-1][1]+(this.model_done?100:0),n=.9*e-.3,r=this.arrivals.filter(e=>e[0]<n).map(e=>e[1]),a=r[r.length-1],o=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let a=e(t),o=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(a>r)throw Error("Lower f is greater than zero");if(o<-r)throw Error("Upper f is less than zero");for(;a<-r;){let r=(t+n)/2,i=e(r);i<=0?(t=r,a=i):(n=r,o=i)}return t}(n=>{let r=(n-this.x)/(e-this.t),o=1/(e-this.t);return 2*this.gamma*o*(r-this.v)-1/(n-a)+1/(t-n)},a,t),i=(o-this.x)/(e-this.t);this.v=this.alpha*this.v+(1-this.alpha)*i,this.x=Math.max(o,this.x),this.t=e,this.smoother_done=this.model_done&&this.x>=this.totalCompletionLength,this.stats.push({t:e,x:o,v:i,min_chars:a,max_chars:t});let s=(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null===(n=e.partial_json)||void 0===n?void 0:n.slice(0,t)}}return e},u=0,l=[];for(let e of this.completionsToSmooth){let t=this._getBlockCharCount(e);if(u+t<this.x)l.push(e),u+=t;else{let t=s(e,this.x-u);l.push(t);break}}return l}onMessage(e){this._set_raw_completion(e)}async task(e,t){for(;!this.smoother_done&&!t.aborted;)e(this._get_smoothed_completion()),await new Promise(e=>setTimeout(e,10))}constructor(){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.completionsToSmooth=[],this.totalCompletionLength=0,this.model_done=!1,this.smoother_done=!1,this.stats=[]}}var k=n(29351),T=n(34077);(r=o||(o={}))[r.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",r[r.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",(a=i||(i={})).Ping="ping",a.Completion="completion",a.Error="error",a.ContentBlockDelta="content_block_delta",a.ContentBlockStart="content_block_start",a.ContentBlockStop="content_block_stop",a.MessageDelta="message_delta",a.MessageStart="message_start",a.MessageStop="message_stop",a.MessageLimit="message_limit";let A=["repl"];async function j(e){let{frontendPrivateApiUrl:t,endpoint:n,orgUuid:r,conversationUuid:a,body:o,onCompletion:i,abortController:s,completion:u,recordToolResult:l,executeReplCode:c,useMessages:d=!1,mcpTools:p}=e,h=new z,g=h.task(i,s.signal),f=null,y=null,_=JSON.stringify({...u,...o,text:void 0,rendering_mode:d?"messages":"raw",organization_uuid:void 0,conversation_uuid:void 0}),b="",C="",x="",S=0,E=async(e,t)=>{let n;try{n=JSON.parse(t)}catch(t){l({tool_id:e,tool_result:"Error parsing input: Invalid JSON"});return}let r=T.KX.safeParse(n);if(r.success)try{let t=await c(r.data.code);l({tool_id:e,tool_result:JSON.stringify(t)})}catch(n){let t=n instanceof Error?n.message:String(n);l({tool_id:e,tool_result:"Error executing code: ".concat(t)})}else l({tool_id:e,tool_result:"Error parsing input: ".concat(r.error.message)})},w=async(e,t,n)=>{let r;try{r=JSON.parse(n)}catch(e){l({tool_id:t,tool_result:"Error parsing input: Invalid JSON"});return}try{let n=await e.callback(r);l({tool_id:t,tool_result:JSON.stringify(n)})}catch(n){let e=n instanceof Error?n.message:String(n);l({tool_id:t,tool_result:"Error executing code: ".concat(e)})}},j=(0,k.L)(function(e,t,n,r,a){let o;if(void 0===n||void 0===r)throw Error("Missing org uuid or conversation uuid");switch(t){case 1:o="completion";break;case 2:o="retry_completion";break;default:throw Error("Invalid endpoint")}return"".concat(e,"/api/organizations/").concat(n,"/chat_conversations/").concat(r,"/").concat(o,"?rendering_mode=").concat(a?"messages":"raw")}(t,n,r,a,d),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:_,openWhenHidden:!0,signal:s.signal,async onopen(e){var t;if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes(k.a))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,m.fT)(e.status,n,"Failed to fetch",e.headers)}d||(h.onMessage({type:"message_start",message:{id:"0",type:"message",role:"assistant",model:"",content:[],stop_reason:null,stop_sequence:null,usage:{input_tokens:0,output_tokens:0}}}),h.onMessage({type:"content_block_start",index:0,content_block:{type:"text",text:""}}))},onmessage(e){var t,n;switch(e.event){case"ping":default:return;case"error":throw(0,m.fT)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let n=JSON.parse(e.data);if(void 0===n.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let r={type:"content_block_delta",index:0,delta:{type:"text_delta",text:n.completion}};f=n.stop_reason,y=null!==(t=n.messageLimit)&&void 0!==t?t:null,h.onMessage(r);break}case"content_block_start":{let t=JSON.parse(e.data);S=t.index,"tool_use"===t.content_block.type&&(C=t.content_block.name,x=t.content_block.id),h.onMessage(t);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==S)throw Error("Content block index did not match the expected index");(null===(n=t.delta)||void 0===n?void 0:n.type)==="input_json_delta"&&(A.includes(C)||(null==p?void 0:p.some(e=>e.name===C)))&&(b+=t.delta.partial_json),h.onMessage(t);break}case"content_block_stop":{if(!C)break;let t=JSON.parse(e.data);if(t.index!==S)throw Error("Content block index did not match the expected index");switch(h.onMessage(t),C){case"test_tool":break;case"repl":E(x,b);break;default:{let e=null==p?void 0:p.find(e=>e.name===C);e&&w(e,x,b)}}b="",C="",x="";break}case"message_delta":case"message_start":case"message_stop":case"message_limit":{let t=JSON.parse(e.data);"message_stop"===t.type&&(f="message_stop"),"message_limit"===t.type&&(y=t.message_limit),h.onMessage(t)}}},onclose(){d||(h.onMessage({type:"content_block_stop",index:0}),h.onMessage({type:"message_stop"})),h.model_done=!0},onerror(e){throw e instanceof m.Hx&&529===e.statusCode||(0,v.Tb)(e),h.model_done=!0,h.smoother_done=!0,e}});return await Promise.all([j,g]),{stopReason:f,messageLimitResult:y}}var N=n(50504),O=n(39206),P=n(27113),I=n(75763);let R=(0,x.createContext)([null,null]);function D(e){let{children:t}=e,n=(0,x.useState)({});return(0,s.jsx)(R.Provider,{value:n,children:t})}function F(e,t,n){let{onIncrementalCompletion:r,onStartAppend:a,onStreamCompleted:i}=(0,I.p)(),s=K({conversationUUID:e,endpoint:o.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:r,onStreamCompleted:i,recordToolResult:t,mcpTools:n}),{runStream:u}=s,l=(0,x.useCallback)(async t=>{let{prompt:n,attachments:r,files:o,rethrowErrors:i=!1,modelOverride:s,parent_message_uuid:l}=t;await a(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,N.HX)(e),a=[{uuid:N.wZ,content:[{type:"text",text:n}],created_at:new Date().toISOString(),sender:"human",attachments:r,files:o,index:t+1,parent_message_uuid:null!=l?l:N.QC},{uuid:N.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],index:t+2,parent_message_uuid:N.wZ}];return(0,N.vv)(e,a)}),await u({prompt:n,attachments:r,files:o,rethrowErrors:i,modelOverride:s,parent_message_uuid:l})},[u,a,e]);return{...s,runStream:l}}function M(e,t,n){let{onIncrementalCompletion:r,onStreamCompleted:a,onStartAppend:i}=(0,I.p)(),s=K({conversationUUID:e,endpoint:o.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:r,onStreamCompleted:a,recordToolResult:t,mcpTools:n}),{runStream:u}=s,l=(0,x.useCallback)(async t=>{await i(e,e=>{let n=[{uuid:N.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],parent_message_uuid:t,selectedOption:0,index:(0,N.HX)(e)+1}];return(0,N.vv)(e,n)}),await u({prompt:"",attachments:[],files:[],parent_message_uuid:t})},[e,u,i]);return{...s,runStream:l}}let q="incomplete_stream",Q=e=>{var t;let n=U(e),{layer:r}=(0,S.useLayer)("frontend"),a=null===(t=r.get("console_default_model_override",null))||void 0===t?void 0:t.model,{config:o}=(0,S.useConfig)("console_default_model"),i=o.get("model",null);return n||a||i||"claude-2.1"},U=e=>{let{data:t}=(0,E.Rq)(e||""),n=(0,C.useSearchParams)(),r=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:r||void 0},L={value:null},H=()=>{let e=(0,y.useQueryClient)();return{failedStreamRetryData:(0,_.useQuery)([g.sf],()=>L.value,{initialData:null}).data||null,setFailedStreamRetryData:(0,x.useCallback)(t=>{L.value=t,e.invalidateQueries([g.sf])},[e])}};function K(e){var t;let{conversationUUID:n,endpoint:r,onIncrementalCompletion:a,onStreamCompleted:o,recordToolResult:i,mcpTools:g}=e,{frontendPrivateApiUrl:y}=(0,l.useConfiguration)(),{activeOrganization:_}=(0,c.useCurrentAccount)(),S=null==_?void 0:_.uuid,z=(0,c.useUseMessagesApiGate)(),{context:k,clearContext:T,setContext:A}=function(e){let[t,n]=(0,x.useContext)(R),[r,a]=(0,x.useState)(),o=(0,x.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):a(void 0)},[e,n]),i=(0,x.useCallback)(t=>{n?n(n=>({...n,[e]:t})):a(t)},[e,n]);return{context:t?t[e]:r,clearContext:o,setContext:i}}(n),N=(0,C.useSearchParams)(),I=null==N?void 0:N.get("t"),D=null!==(t=U(n))&&void 0!==t?t:"",F=null==N?void 0:N.get("max_tokens"),M=(0,P.n)(),{addError:Q,clearToast:L}=(0,d.useToasts)(),K=(0,x.useMemo)(f.H,[]),W=(0,E.$H)("push",K),{setFailedStreamRetryData:G}=H(),J=(0,x.useCallback)(async e=>{await (null==o?void 0:o(n,e)),T()},[o,n,T]),{executeReplCode:Y}=(0,w.M)(),Z=(0,x.useCallback)((e,t)=>{if(e===q)return Q("Network connection interrupted. Claude may still be responding, please wait for a bit to see the response.");if(!(e instanceof m.Hx))return Q("We couldnâ€™t connect to Claude. Please check your network connection and try again.");if("rate_limit_error"===e.type){if(e.message.includes("{")&&S)try{let t=JSON.parse(e.message);M(t,S,n)}catch(e){}return Q((0,s.jsxs)("p",{children:["You've reached the limit for Claude messages at this time. Please wait before trying again. ",(0,s.jsx)(u.Z,{})]}))}if("not_found_error"===e.type)return Q((0,s.jsx)("p",{children:"Claude model version not found."}));if("overloaded_error"===e.type)return Q((0,s.jsxs)("p",{children:["Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",(0,s.jsx)(u.Z,{})]}));if("invalid_request_error"===e.type&&413===e.statusCode){let e=Q((0,s.jsxs)("p",{children:["Your message will exceed the"," ",(0,s.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.jC,children:"length limit"})," ","for this chat.",t>0?" Try attaching fewer or smaller files":" Try shortening your message"," ",(0,s.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),W(),L(e)},children:"or starting a new conversation."}),(0,s.jsx)(u.Z,{})]}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?Q((0,s.jsx)("p",{children:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while."})):Q(e)},[Q,S,M,n,W,L]),$=(0,p.K)(),B=(0,x.useCallback)(async e=>{let{prompt:t,attachments:o,files:s,rethrowErrors:u=!1,modelOverride:l,parent_message_uuid:c}=e;if(k)return;if(!_)throw Error("Cannot stream without an organization");let d=new AbortController;A({controller:d}),G(null);let p={prompt:t,parent_message_uuid:c,timezone:b.ou.local().zoneName||void 0},m=(0,O.l)();m&&(p.custom_system_prompt=m),D&&"string"==typeof D&&(p.model=D),l&&(p.model=l),"string"==typeof I&&(p.temperature=parseInt(I)),F&&"string"==typeof F&&(p.max_tokens_to_sample=parseInt(F)),g&&(p.tools=g.map(e=>{var t;return{name:e.name,description:null!==(t=e.description)&&void 0!==t?t:e.name,input_schema:e.inputSchema}}));let h=[],f=null,C=null,x=null;try{f=(x=await j({frontendPrivateApiUrl:y,endpoint:r,orgUuid:_.uuid,conversationUuid:n,body:{organization_uuid:_.uuid,conversation_uuid:n,text:t,attachments:o,files:s.map(e=>e.file_uuid)},onCompletion:e=>{a(n,e),h=e},abortController:d,completion:p,useMessages:z,recordToolResult:i,executeReplCode:Y,mcpTools:g})).stopReason,C=x.messageLimitResult}catch(e){if(G({prompt:t,attachments:o,files:s}),Z(e,o.length+s.length),u)throw e}finally{x&&!f&&(a(n,h),Z(q,o.length+s.length),$.track("sse_interrupted"),(0,v.uT)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))),await J(C)}return h},[y,k,_,A,D,I,a,n,r,Z,J,F,G,$,z,i,Y,g]),V=(0,x.useCallback)(()=>{k&&(k.controller.abort(),J(null))},[k,J]);return{runStream:B,isStreaming:!!k,abortStream:V}}},39206:function(e,t,n){n.d(t,{h:function(){return o},l:function(){return i}});var r=n(7653);let a="customSystemPrompt",o=()=>{let[e,t]=(0,r.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)||"");return(0,r.useEffect)(()=>{localStorage.setItem(a,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},i=()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)},27809:function(e,t,n){n.d(t,{V:function(){return u},u:function(){return l}});var r=n(83041),a=n(16096),o=n(35146),i=n(80248);let s={image_in:!1},u=e=>{let{activeOrganization:t}=(0,a.useCurrentAccount)(),n=null==t?void 0:t.uuid,{data:i,isLoading:u,isPreviousData:l}=(0,r.WE)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[o.Qn,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}});return{isLoading:u,modelConfig:!l&&i||s}},l=()=>{let{config:e}=(0,i.useConfig)("claude_ai_models"),t=e.get("models",[]),n=t.filter(e=>!e.inactive);return{allModelOptions:t,activeModelOptions:n}}},78429:function(e,t,n){n.d(t,{b:function(){return c},w:function(){return d}});var r=n(28505),a=n(84983),o=n(19073),i=n.n(o),s=n(54603),u=n(7653),l=n(94354);let c=()=>{let e="new-conversation-params-for-navigation",t=(0,a.useQueryClient)(),n=(0,u.useCallback)(()=>{let t=localStorage.getItem(e);if(!t)return{};try{let e=JSON.parse(t);return i()(e,e=>Date.now()-e.created_at<6e4)}catch(t){localStorage.removeItem(e)}return{}},[]);return{prepareNewConversation:(0,u.useCallback)((r,a)=>{let o={created_at:Date.now(),...a};t.setQueryData([e,r],o);let i=n();i[r]=o;try{localStorage.setItem(e,JSON.stringify(i))}catch(e){}},[t,n]),getCreateParamsForConvo:(0,u.useCallback)(r=>{let a=n(),o=t.getQueryData([e,r])||a[r];t.removeQueries([e,r]);let s=i()(a,(e,t)=>t!==r);return localStorage.setItem(e,JSON.stringify(s)),o},[t,n])}},d=()=>{let{mutateAsync:e}=(0,l.$Y)(),[t,n]=(0,u.useReducer)(r.H,"",r.H),{prepareNewConversation:a}=c(),o=(0,s.useRouter)();return(0,u.useCallback)(async r=>{let{model:i,project_uuid:s}=r,u=e({uuid:t,name:"",model:i,project_uuid:s});a(t,r),await u,o.push("/chat/".concat(t)),n()},[e,t,o,a])}},10075:function(e,t,n){n.d(t,{M:function(){return u}});var r=n(87050),a=n(2645),o=n(7653),i=n(11925),s=n(27809);let u=()=>{let e="sticky-model-selector",{value:t}=(0,r.F)("sticky_model_selector"),{value:n}=(0,r.F)("model_selector_enabled"),{activeModelOptions:u}=(0,s.u)(),l=(0,i.wN)(null),c=(0,a.useQuery)([e],()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===l?null:r&&u.find(e=>e.model===r)?r:null},{initialData:null}),d=(0,o.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},27113:function(e,t,n){n.d(t,{I:function(){return l},n:function(){return u}});var r=n(83041),a=n(16096),o=n(35146),i=n(84983),s=n(7653);let u=()=>{let e=(0,i.useQueryClient)();return(0,s.useCallback)((t,n,r)=>{"within_limit"!==t.type&&t.perModelLimit&&(t.conversationUUID=r),e.setQueryData([o.aY],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},l=e=>{let{activeOrganization:t}=(0,a.useCurrentAccount)(),n=null==t?void 0:t.uuid,o=u(),i={type:"within_limit"};return(0,r.uC)(()=>"/api/organizations/".concat(n,"/reset_rate_limits"),"POST",{onSuccess:()=>{o(i,n,e||"")},meta:{noToast:!0}})}},75763:function(e,t,n){n.d(t,{p:function(){return l}});var r=n(16096),a=n(35146),o=n(84983),i=n(7653),s=n(50504),u=n(27113);let l=()=>{let e=(0,o.useQueryClient)(),{activeOrganization:t}=(0,r.useCurrentAccount)(),n=null==t?void 0:t.uuid,l=(0,i.useRef)(),c=(0,u.n)(),d=(0,i.useCallback)(async(t,r)=>{let o=[a.I8,{orgUUID:n},{uuid:t}],i=e.getQueryData(o);if(!i)throw Error("Conversation tree must be provided for append");let s=r(i);l.current=s,await e.cancelQueries(o),e.setQueryData(o,l.current)},[e,n]),p=(0,i.useCallback)((t,r)=>{0!==r.length&&e.setQueryData([a.I8,{orgUUID:n},{uuid:t}],()=>{let e=l.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=r,{...e,created_at:new Date().toISOString()}})},[e,n]);return{onStartAppend:d,onStreamCompleted:(0,i.useCallback)(async(t,r)=>{let o=[a.I8,{orgUUID:n},{uuid:t}];l.current=void 0,r?(e.setQueryData([a.tv,{orgUUID:n}],e=>{if(!e)return;let n=e.find(e=>e.uuid===t);return n?[{...n,updated_at:new Date().toISOString()},...e.filter(e=>e.uuid!==t)]:e}),await e.invalidateQueries(o)):e.invalidateQueries(o),r&&n&&c(r,n,t)},[e,c,n]),onIncrementalCompletion:p,changeDisplayedConversationPath:(0,i.useCallback)((t,r,o,i)=>{e.setQueryData([a.I8,{orgUUID:n},{uuid:t}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,s.mj)(e,r,o);return t.current_leaf_message_uuid&&i&&i(t.current_leaf_message_uuid),t})},[e,n])}}},64507:function(e,t,n){n.d(t,{An:function(){return x},HZ:function(){return E},JP:function(){return a},Km:function(){return y},VA:function(){return d},kE:function(){return l},l2:function(){return _},tE:function(){return S},w0:function(){return C},yc:function(){return c}});var r,a,o,i=n(68444),s=n(31087),u=n(87365);(r=a||(a={})).Text="text/plain",r.Markdown="text/markdown",r.Html="text/html",r.Code="application/vnd.ant.code",r.Svg="image/svg+xml",r.Mermaid="application/vnd.ant.mermaid",r.React="application/vnd.ant.react",(o||(o={})).Repl="application/vnd.ant.repl";let l=i.z.object({command:i.z.enum(["create","update","rewrite"]).optional().catch(void 0),id:i.z.string().optional(),title:i.z.string().optional(),type:i.z.nativeEnum(a).optional().catch(void 0),language:i.z.string().optional(),content:i.z.string().optional(),old_str:i.z.string().optional(),new_str:i.z.string().optional()}),c={"text/plain":{syntaxName:"plaintext",displayName:"text",extension:()=>"txt"},"text/markdown":{syntaxName:"markdown",displayName:"document",extension:()=>"md"},"text/html":{syntaxName:"html",displayName:"website",extension:()=>"html"},"image/svg+xml":{syntaxName:"svg",displayName:"image",extension:()=>"svg"},"application/vnd.ant.code":{syntaxName:"plaintext",displayName:"code",extension:e=>{switch(null==e?void 0:e.language){case"python":return"py";case"javascript":return"js";case"typescript":return"ts";case"java":return"java";case"csharp":return"cs";case"go":return"go";case"rust":return"rs";case"ruby":return"rb";case"php":return"php";case"swift":return"swift";case"kotlin":return"kt";case"dart":return"dart";case"scala":return"scala";case"perl":return"pl";case"elixir":return"ex";case"haskell":return"hs";case"clojure":return"clj";case"r":return"r";case"groovy":return"groovy";case"bash":return"sh";case"css":return"css";case"scss":return"scss";case"less":return"less";case"sql":return"sql";case"graphql":return"graphql";case"json":return"json";case"html":return"html";default:return"txt"}}},"application/vnd.ant.mermaid":{syntaxName:"mermaid",displayName:"diagram",extension:()=>"mermaid"},"application/vnd.ant.react":{syntaxName:"tsx",displayName:"component",extension:()=>"tsx"}},d=e=>{let t=c[e.type];return"application/vnd.ant.code"!==e.type?t.extension():t.extension(e)},p="antArtifact",m="<".concat(p,"(?:\\s+([^>]*)>|(?!>)\\S*)"),h="</".concat(p,">"),g=RegExp("".concat(m,"([\\s\\S]*?)(?:").concat(h,"|$)"),"g"),f=RegExp("<(?:a(?:n(?:t(?:A(?:r(?:t(?:i(?:f(?:a(?:c(?:t)?)?)?)?)?)?)?)?)?)?)?$","gm"),v=RegExp("".concat(m,"[\\s\\S]*?(?:").concat(h,"|$)"),"g"),y="ANTARTIFACTLINK";function _(e){var t;let n=e.match(/identifier="([^"]*)"/),r=n?n[1]:"",o=e.match(/type="([^"]*)"/),i=o?(t=o[1],Object.values(a).includes(t)?t:"text/plain"):"text/plain",s=e.match(/title="([^"]*)"/),u=s?s[1]:"Untitled artifact",l=e.match(/language="([^"]*)"/),c=l?l[1]:void 0,d=e.match(/isClosed="(true|false)"/);return{id:r,type:i,title:u,language:c,isClosed:d?"true"===d[1]:void 0}}function b(e){return e.replace(f,"")}function C(e){return A(b(e)).replace(g,(e,t,n)=>{if(!t||"string"!=typeof t)return"";{let{type:e,language:r}=_(t);return"text/markdown"!==e&&"string"==typeof n?"```".concat(r||c[e].syntaxName,"\n").concat(n.trimStart(),"\n```"):"\n".concat(n)}})}function x(e){return b(A(e).replace(v,(e,t)=>{let n=e.endsWith(h);return"<".concat(y," ").concat(t,' isClosed="').concat(n,'" />')}))}let S=(e,t)=>"create"===e.command||"rewrite"===e.command?e.content:"update"===e.command?void 0===t?e.new_str:t.includes(e.old_str)?t.replace(e.old_str,e.new_str):t.replace(e.old_str.trim(),e.new_str):null!=t?t:"";function E(e){var t;let n=(0,s.K)(e).matchAll(g),r=[];for(let t of n){let[n,a,o]=t,i=n.endsWith(h);if(!a||!o)continue;let{id:s,type:u,title:l,language:c}=_(a),d={command:"create",message:e.uuid||"",created_at:e.created_at,content:o.trimStart(),isClosed:i};r.push({id:s,currentVersion:d,type:u,title:l,language:c})}return null===(t=e.content)||void 0===t||t.map((t,n,a)=>{if("tool_use"===t.type&&"artifacts"===t.name&&t.input){let o;let i=(0,u.n)(t),s=n===a.length-1,{command:c,id:d,type:p,title:m="",language:h,content:g="",old_str:f="",new_str:v=""}=l.parse(i);"create"===c||"rewrite"===c?o={command:c,message:e.uuid||"",created_at:e.created_at,content:g.trimStart(),isClosed:!s}:"update"===c&&""!==g?o={command:"rewrite",message:e.uuid||"",created_at:e.created_at,isClosed:!s,content:g}:"update"===c&&(o={command:"update",message:e.uuid||"",created_at:e.created_at,isClosed:!s,old_str:f,new_str:v}),void 0!==p&&void 0!==d&&void 0!==o&&r.push({id:d,currentVersion:o,type:p,title:m,language:h})}}),r}let w="antThinking",z="<".concat(w,">"),k=RegExp("".concat(z,"[\\s\\S]*?(?:</").concat(w,">|$)"),"g"),T=RegExp("<(?:a(?:n(?:t(?:T(?:h(?:i(?:n(?:k(?:i(?:n(?:g)?)?)?)?)?)?)?)?)?)?)?$","gm");function A(e){return e.replace(T,"").replace(k,"")}},87365:function(e,t,n){n.d(t,{n:function(){return r}});let r=e=>{if(e.input&&Object.keys(e.input).length>0)return e.input;if(e.partial_json){let t={};try{t=function(e){let t=function(e){let t=[],n=0;for(;n<e.length;){let r=e[n];if(/\s/.test(r)){n++;continue}if("{[]}:,".includes(r)){t.push(r),n++;continue}if('"'===r){let a=r;n++;let o=!1,i=!1;for(;n<e.length;){if(a+=r=e[n],'"'===r&&!o){i=!0;break}o="\\"===r&&!o,n++}i||(a.slice(-5).includes("\\")&&(a=a.slice(0,a.lastIndexOf("\\"))),a+='"'),t.push(a),n++;continue}if(/[-0-9]/.test(r)){let r="";for(;n<e.length&&/[-0-9.eE+]/.test(e[n]);)r+=e[n],n++;if(!r.match(/\d$/))for(;r.length>0&&!r[r.length-1].match(/\d/);)r=r.slice(0,-1);t.push(r);continue}if(/[tfn]/.test(r)){let a="",o=["true","false","null"],i=o.filter(e=>e.startsWith(r));if(1===i.length)n+=(a=i[0]).length;else for(;n<e.length&&/[a-z]/.test(e[n])&&(a+=e[n],n++,!o.includes(a)););o.includes(a)&&t.push(a);continue}n++}return t}(e),n=[];for(let e of t)"{"===e||"["===e?n.push("{"===e?"}":"]"):("}"===e||"]"===e)&&n.length>0&&n.pop();n.reverse(),","===t[t.length-1]&&t.pop();let r=t.concat(n).join("");if(""===r)return null;try{return JSON.parse(r)}catch(r){let e=Math.max(t.lastIndexOf(","),t.lastIndexOf("{"),t.lastIndexOf("["));if(-1!==e){let r=t.slice(0,e+1);return","===r[r.length-1]&&r.pop(),JSON.parse(r.concat(n).join(""))}throw Error("Invalid JSON")}}(e.partial_json)}catch(e){}return null!=t?t:{}}return{}}}}]);